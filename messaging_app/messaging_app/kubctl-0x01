#!/bin/bash

set -e 

APP_NAME="messaging-app"
ENDPOINT="http://127.0.0.1:8000/admin"
LABEL=messaging

echo "ğŸ“¦ Scaling $APP_NAME to 3 replicas..."
kubectl scale deployment $APP_NAME --replicas=3

echo "â³ Waiting for all pods to be ready..."
kubectl wait --for=condition=Ready pod -l app=$LABEL --timeout=60s

echo "âœ… Current pods:"
kubectl get pods -o wide


echo "ğŸš€ Starting load test on $ENDPOINT..."
wrk -t12 -c400 -d30s $ENDPOINT

echo "ğŸ“Š Resource usage after load test:"
kubectl top pods

